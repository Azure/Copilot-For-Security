{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "workbookDisplayName": {
        "type": "string",
        "defaultValue": "Copilot for Security Test Workbook",
        "metadata": {
          "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
        }
      },
      "workbookId":{
        "type": "string",        
        "metadata": {
          "description": "The unique identifier for the workbook. This identifier is used in the URL for the workbook. https://guidgenerator.com"
        }
      },
      "workspace": {
            "type": "string"
        }
    },
    "variables": {      
      "WorkbookSourceId": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspace'))]"
    },
    "resources": [
      {
        "name": "[parameters('workbookId')]",
        "type": "microsoft.insights/workbooks",
        "location": "[resourceGroup().location]",
        "apiVersion": "2022-04-01",
        "dependsOn": [],
        "kind": "shared",
        "properties": {
          "displayName": "[parameters('workbookDisplayName')]",
          "serializedData": "{\r\n\"version\":\"Notebook/1.0\",\r\n\"items\":[\r\n{\r\n\"type\":1,\r\n\"content\":{\r\n\"json\":\"#[CopilotforSecurityAuditWorkbook](https://learn.microsoft.com/en-us/copilot/security/microsoft-security-copilot)\\n---\\n\\nMicrosoftCopilotforSecurityisagenerativeAI-poweredsecuritysolutiondesignedtoenhancetheefficiencyandcapabilitiesofsecurityprofessionals1.Itsupportsend-to-endscenariossuchasincidentresponse,threathunting,intelligencegathering,andposturemanagement2.ByintegratingwithproductslikeMicrosoftDefenderXDR,MicrosoftSentinel,andMicrosoftIntune,aswellasthird-partyserviceslikeServiceNow,CopilotforSecurityleveragessecurity-specificplugins,organizationaldata,authoritativesources,andglobalthreatintelligence3.Thisenablessecurityprofessionalstogainwidervisibilityintothreats,prioritizeresponseefforts,andstreamlinedecision-making4.CopilotforSecurityprovidesactionableguidanceforincidentresponse,translatingcomplexsecurityalertsintoconcisesummariesandofferingstep-by-stepdirectionsfortriage,investigation,containment,andremediation.\"\r\n},\r\n\"name\":\"text-2\"\r\n},\r\n{\r\n\"type\":11,\r\n\"content\":{\r\n\"version\":\"LinkItem/1.0\",\r\n\"style\":\"tabs\",\r\n\"links\":[\r\n{\r\n\"id\":\"f16d570f-12c1-48f2-94fa-7e114263a291\",\r\n\"cellValue\":\"Nav\",\r\n\"linkTarget\":\"parameter\",\r\n\"linkLabel\":\"CopilotforSecurityAudit\",\r\n\"subTarget\":\"audit\",\r\n\"preText\":\"CopilotforSecurityAuditData\",\r\n\"style\":\"link\"\r\n},\r\n{\r\n\"id\":\"ab2c8e5c-1a0f-4041-ab18-c9b387ecf33b\",\r\n\"cellValue\":\"Nav\",\r\n\"linkTarget\":\"parameter\",\r\n\"linkLabel\":\"CopilotforSecuritySigninData\",\r\n\"subTarget\":\"Signin\",\r\n\"style\":\"link\"\r\n},\r\n{\r\n\"id\":\"03e3f1de-2a0f-4f14-ad2f-cba53365c4b3\",\r\n\"cellValue\":\"Nav\",\r\n\"linkTarget\":\"parameter\",\r\n\"linkLabel\":\"CopilotforSecuritySCUEvents\",\r\n\"subTarget\":\"SCU\",\r\n\"style\":\"link\"\r\n}\r\n]\r\n},\r\n\"name\":\"links-2\",\r\n\"styleSettings\":{\r\n\"padding\":\"0\",\r\n\"showBorder\":true\r\n}\r\n},\r\n{\r\n\"type\":12,\r\n\"content\":{\r\n\"version\":\"NotebookGroup/1.0\",\r\n\"groupType\":\"editable\",\r\n\"items\":[\r\n{\r\n\"type\":9,\r\n\"content\":{\r\n\"version\":\"KqlParameterItem/1.0\",\r\n\"parameters\":[\r\n{\r\n\"id\":\"e3388fc6-e10b-4a86-bdc1-22677adcb351\",\r\n\"version\":\"KqlParameterItem/1.0\",\r\n\"name\":\"TimeRange\",\r\n\"type\":4,\r\n\"typeSettings\":{\r\n\"selectableValues\":[\r\n{\r\n\"durationMs\":300000\r\n},\r\n{\r\n\"durationMs\":900000\r\n},\r\n{\r\n\"durationMs\":1800000\r\n},\r\n{\r\n\"durationMs\":3600000\r\n},\r\n{\r\n\"durationMs\":14400000\r\n},\r\n{\r\n\"durationMs\":43200000\r\n},\r\n{\r\n\"durationMs\":86400000\r\n},\r\n{\r\n\"durationMs\":172800000\r\n},\r\n{\r\n\"durationMs\":259200000\r\n},\r\n{\r\n\"durationMs\":604800000\r\n},\r\n{\r\n\"durationMs\":1209600000\r\n},\r\n{\r\n\"durationMs\":2419200000\r\n},\r\n{\r\n\"durationMs\":2592000000\r\n},\r\n{\r\n\"durationMs\":5184000000\r\n},\r\n{\r\n\"durationMs\":7776000000\r\n}\r\n]\r\n},\r\n\"timeContext\":{\r\n\"durationMs\":86400000\r\n},\r\n\"value\":{\r\n\"durationMs\":2419200000\r\n}\r\n},\r\n{\r\n\"id\":\"4f442515-aa9d-41ff-9891-acdb998b1a4d\",\r\n\"version\":\"KqlParameterItem/1.0\",\r\n\"name\":\"DefaultWorkspace\",\r\n\"type\":5,\r\n\"typeSettings\":{\r\n\"resourceTypeFilter\":{\r\n\"microsoft.operationalinsights/workspaces\":true\r\n},\r\n\"additionalResourceOptions\":[\r\n\"value::1\"\r\n]\r\n},\r\n\"value\":\"\"\r\n}\r\n],\r\n\"style\":\"pills\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\"\r\n},\r\n\"name\":\"parameters-11-Copy\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"letIP_Data=\\r\\nexternal_data(network:string,geoname_id:long,continent_code:string,continent_name:string,country_iso_code:string,country_name:string,is_anonymous_proxy:bool,is_satellite_provider:bool)\\r\\n[@\\\"https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv\\\"]\\r\\nwith(ignoreFirstRecord=true,format=\\\"csv\\\");\\r\\nIdentityLogonEvents\\r\\n|whereAdditionalFields.[\\\"ARG.CLOUD_SERVICE\\\"]==\\\"MedeinaPortal\\\"\\r\\n|extendIPaddresses=tostring(IPAddress)\\r\\n|whereisnotempty(IPaddresses)\\r\\n|evaluateipv4_lookup(IP_Data,IPaddresses,network)\\r\\n|summarizeinteractioncount=count()byIPAddress,country_name\\r\\n\",\r\n\"size\":2,\r\n\"title\":\"SuccesfullSIgninsByLocation\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"map\",\r\n\"mapSettings\":{\r\n\"locInfo\":\"CountryRegion\",\r\n\"locInfoColumn\":\"country_name\",\r\n\"sizeSettings\":\"interactioncount\",\r\n\"sizeAggregation\":\"Sum\",\r\n\"legendMetric\":\"interactioncount\",\r\n\"legendAggregation\":\"Sum\",\r\n\"itemColorSettings\":{\r\n\"nodeColorField\":\"interactioncount\",\r\n\"colorAggregation\":\"Sum\",\r\n\"type\":\"heatmap\",\r\n\"heatmapPalette\":\"greenRed\"\r\n}\r\n}\r\n},\r\n\"customWidth\":\"50\",\r\n\"name\":\"query-3\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"letIP_Data=\\r\\nexternal_data(network:string,geoname_id:long,continent_code:string,continent_name:string,country_iso_code:string,country_name:string,is_anonymous_proxy:bool,is_satellite_provider:bool)\\r\\n[@\\\"https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv\\\"]\\r\\nwith(ignoreFirstRecord=true,format=\\\"csv\\\");\\r\\nBehaviorAnalytics\\r\\n|whereActivityInsights.App==\\\"MedeinaPortal\\\"\\r\\n|whereActivityInsights.Resource==\\\"MedeinaService\\\"\\r\\n|whereActivityType==\\\"FailedLogOn\\\"\\r\\n|extendIPaddresses=tostring(SourceIPAddress)\\r\\n|whereisnotempty(IPaddresses)\\r\\n|evaluateipv4_lookup(IP_Data,IPaddresses,network)\\r\\n|summarizeinteractioncount=count()bySourceIPAddress,country_name\\r\\n\",\r\n\"size\":2,\r\n\"title\":\"FailedSIgninsbyLocation\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"map\",\r\n\"mapSettings\":{\r\n\"locInfo\":\"CountryRegion\",\r\n\"locInfoColumn\":\"country_name\",\r\n\"sizeSettings\":\"interactioncount\",\r\n\"sizeAggregation\":\"Sum\",\r\n\"legendMetric\":\"interactioncount\",\r\n\"legendAggregation\":\"Sum\",\r\n\"itemColorSettings\":{\r\n\"nodeColorField\":\"interactioncount\",\r\n\"colorAggregation\":\"Sum\",\r\n\"type\":\"heatmap\",\r\n\"heatmapPalette\":\"greenRed\"\r\n}\r\n}\r\n},\r\n\"customWidth\":\"50\",\r\n\"name\":\"query-5\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"IdentityLogonEvents\\r\\n|whereTimeGenerated>=ago(24h)\\r\\n|whereAdditionalFields.[\\\"ARG.CLOUD_SERVICE\\\"]==\\\"MedeinaPortal\\\"\\r\\n|extendUser=AdditionalFields.[\\\"ACTOR.ALIAS\\\"]\\r\\n|projectAccountDomain,User,ActionType,AccountUpn,IPAddress,Location,ISP,OSPlatform,DeviceType\",\r\n\"size\":0,\r\n\"title\":\"SuccessfullSigninsforCopilotforSecurity\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n]\r\n},\r\n\"customWidth\":\"100\",\r\n\"name\":\"query-0\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"//FailedsigninstotheCfSserviceexposinguser,reason,andothernecessaryinformation.\\r\\n\\r\\nBehaviorAnalytics\\r\\n|whereTimeGenerated>=ago(7d)\\r\\n|whereActivityInsights.App==\\\"MedeinaPortal\\\"\\r\\n|whereActivityInsights.Resource==\\\"MedeinaService\\\"\\r\\n|whereActivityType==\\\"FailedLogOn\\\"\\r\\n|projectUserName,UserPrincipalName,ActionType,EventSource,SourceIPAddress,SourceIPLocation\",\r\n\"size\":0,\r\n\"title\":\"FailedSigninsforCopilotforSecurity\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"gridSettings\":{\r\n\"formatters\":[\r\n{\r\n\"columnMatch\":\"ActionType\",\r\n\"formatter\":18,\r\n\"formatOptions\":{\r\n\"thresholdsOptions\":\"colors\",\r\n\"thresholdsGrid\":[\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"UserdidnotpasstheMFAchallenge\",\r\n\"representation\":\"redBright\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"\\tOther\",\r\n\"representation\":\"gray\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"Invalidusernameorpassword\",\r\n\"representation\":\"orange\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"Flowtokenexpired-AuthenticationFailed\",\r\n\"representation\":\"blue\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"DeviceAuthenticationRequired\",\r\n\"representation\":\"yellow\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"Default\",\r\n\"thresholdValue\":null,\r\n\"representation\":\"gray\",\r\n\"text\":\"{0}{1}\"\r\n}\r\n]\r\n}\r\n}\r\n]\r\n}\r\n},\r\n\"customWidth\":\"100\",\r\n\"name\":\"query-2\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"BehaviorAnalytics\\r\\n|whereTimeGenerated>=ago(7d)\\r\\n|whereActivityInsights.App==\\\"MedeinaPortal\\\"\\r\\n|whereActivityInsights.Resource==\\\"MedeinaService\\\"\\r\\n|whereActivityType==\\\"FailedLogOn\\\"\\r\\n|summarizeFailedlogin=count()byActionType\\r\\n\",\r\n\"size\":0,\r\n\"title\":\"FailedSigninsByReason\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"piechart\"\r\n},\r\n\"customWidth\":\"30\",\r\n\"name\":\"query-4\"\r\n}\r\n]\r\n},\r\n\"conditionalVisibility\":{\r\n\"parameterName\":\"Nav\",\r\n\"comparison\":\"isEqualTo\",\r\n\"value\":\"Signin\"\r\n},\r\n\"name\":\"group-3\"\r\n},\r\n{\r\n\"type\":12,\r\n\"content\":{\r\n\"version\":\"NotebookGroup/1.0\",\r\n\"groupType\":\"editable\",\r\n\"items\":[\r\n{\r\n\"type\":9,\r\n\"content\":{\r\n\"version\":\"KqlParameterItem/1.0\",\r\n\"parameters\":[\r\n{\r\n\"id\":\"061dd12a-4223-4b86-8d66-51dd276c35ae\",\r\n\"version\":\"KqlParameterItem/1.0\",\r\n\"name\":\"TimeRange\",\r\n\"type\":4,\r\n\"typeSettings\":{\r\n\"selectableValues\":[\r\n{\r\n\"durationMs\":300000\r\n},\r\n{\r\n\"durationMs\":900000\r\n},\r\n{\r\n\"durationMs\":1800000\r\n},\r\n{\r\n\"durationMs\":3600000\r\n},\r\n{\r\n\"durationMs\":14400000\r\n},\r\n{\r\n\"durationMs\":43200000\r\n},\r\n{\r\n\"durationMs\":86400000\r\n},\r\n{\r\n\"durationMs\":172800000\r\n},\r\n{\r\n\"durationMs\":259200000\r\n},\r\n{\r\n\"durationMs\":604800000\r\n},\r\n{\r\n\"durationMs\":1209600000\r\n},\r\n{\r\n\"durationMs\":2419200000\r\n},\r\n{\r\n\"durationMs\":2592000000\r\n},\r\n{\r\n\"durationMs\":5184000000\r\n},\r\n{\r\n\"durationMs\":7776000000\r\n}\r\n]\r\n},\r\n\"timeContext\":{\r\n\"durationMs\":86400000\r\n},\r\n\"value\":{\r\n\"durationMs\":604800000\r\n}\r\n},\r\n{\r\n\"id\":\"31831857-13e1-4061-b44e-c9b9acf2bd30\",\r\n\"version\":\"KqlParameterItem/1.0\",\r\n\"name\":\"DefaultWorkspace\",\r\n\"type\":5,\r\n\"typeSettings\":{\r\n\"resourceTypeFilter\":{\r\n\"microsoft.operationalinsights/workspaces\":true\r\n},\r\n\"additionalResourceOptions\":[\r\n\"value::1\"\r\n]\r\n},\r\n\"value\":\"\"\r\n}\r\n],\r\n\"style\":\"pills\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\"\r\n},\r\n\"name\":\"parameters-11\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereUserId_s!=\\\"\\\"\\r\\n|whereUserId_s!=\\\"SecurityCopilot\\\"\\r\\n|distinctUserId_s\\r\\n|count\",\r\n\"size\":4,\r\n\"title\":\"TotalnumberofusersforCopilotforSecurity\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"tiles\",\r\n\"tileSettings\":{\r\n\"titleContent\":{\r\n\"columnMatch\":\"Count\",\r\n\"formatter\":8,\r\n\"formatOptions\":{\r\n\"palette\":\"orangeDark\"\r\n},\r\n\"numberFormat\":{\r\n\"unit\":0,\r\n\"options\":{\r\n\"style\":\"decimal\"\r\n}\r\n}\r\n},\r\n\"showBorder\":true\r\n}\r\n},\r\n\"customWidth\":\"16\",\r\n\"name\":\"query-3\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereOperation_s!=\\\"CopilotInteraction\\\"\\r\\n|count\",\r\n\"size\":4,\r\n\"title\":\"TotalNo:CopilotforSecurity-Interactions\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"tiles\",\r\n\"tileSettings\":{\r\n\"titleContent\":{\r\n\"columnMatch\":\"Count\",\r\n\"formatter\":8,\r\n\"formatOptions\":{\r\n\"palette\":\"orangeDark\"\r\n},\r\n\"numberFormat\":{\r\n\"unit\":0,\r\n\"options\":{\r\n\"style\":\"decimal\"\r\n}\r\n}\r\n},\r\n\"showBorder\":true\r\n}\r\n},\r\n\"customWidth\":\"16\",\r\n\"name\":\"query-3-Copy\",\r\n\"styleSettings\":{\r\n\"maxWidth\":\"20\"\r\n}\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereOperation_scontains\\\"file\\\"\\r\\n|count\",\r\n\"size\":4,\r\n\"title\":\"FileUploads\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"tiles\",\r\n\"tileSettings\":{\r\n\"titleContent\":{\r\n\"columnMatch\":\"Count\",\r\n\"formatter\":8,\r\n\"formatOptions\":{\r\n\"palette\":\"orangeDark\"\r\n},\r\n\"numberFormat\":{\r\n\"unit\":0,\r\n\"options\":{\r\n\"style\":\"decimal\"\r\n}\r\n}\r\n},\r\n\"showBorder\":true\r\n}\r\n},\r\n\"customWidth\":\"17\",\r\n\"name\":\"query-3-Copy-Copy\",\r\n\"styleSettings\":{\r\n\"maxWidth\":\"20\"\r\n}\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereOperation_scontains\\\"Disable\\\"\\r\\n|count\",\r\n\"size\":4,\r\n\"title\":\"DisabledCopilotforSecurityPlugins\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"tiles\",\r\n\"tileSettings\":{\r\n\"titleContent\":{\r\n\"columnMatch\":\"Count\",\r\n\"formatter\":8,\r\n\"formatOptions\":{\r\n\"palette\":\"orangeDark\"\r\n},\r\n\"numberFormat\":{\r\n\"unit\":0,\r\n\"options\":{\r\n\"style\":\"decimal\"\r\n}\r\n}\r\n},\r\n\"showBorder\":true\r\n}\r\n},\r\n\"customWidth\":\"17\",\r\n\"name\":\"query-3-Copy-Copy-Copy\",\r\n\"styleSettings\":{\r\n\"maxWidth\":\"20\"\r\n}\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"SecurityAlert\\r\\n|whereDisplayName==\\\"TImapIPentitytoCopilotForSecurityAuditPrompts\\\"\\r\\n|whereDisplayName==\\\"CFS-Anomaloussign-inactivitybyCopilotforSecurityuser\\\"\\r\\n|whereDisplayName==\\\"CFS-AnomalousOperationsbyCopilotforSecurityUser\\\"\\r\\n|count\",\r\n\"size\":4,\r\n\"title\":\"CopilotForSecurityDetections\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"tiles\",\r\n\"tileSettings\":{\r\n\"titleContent\":{\r\n\"columnMatch\":\"Count\",\r\n\"formatter\":8,\r\n\"formatOptions\":{\r\n\"palette\":\"orangeDark\"\r\n},\r\n\"numberFormat\":{\r\n\"unit\":0,\r\n\"options\":{\r\n\"style\":\"decimal\"\r\n}\r\n}\r\n},\r\n\"showBorder\":true\r\n}\r\n},\r\n\"customWidth\":\"17\",\r\n\"name\":\"query-3-Copy-Copy-Copy-Copy-Copy\",\r\n\"styleSettings\":{\r\n\"maxWidth\":\"20\"\r\n}\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereOperation_scontains\\\"UpdateCopilotSettings\\\"\\r\\n|count\",\r\n\"size\":4,\r\n\"title\":\"ChangedCopilotforSecuritySettings\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"tiles\",\r\n\"tileSettings\":{\r\n\"titleContent\":{\r\n\"columnMatch\":\"Count\",\r\n\"formatter\":8,\r\n\"formatOptions\":{\r\n\"palette\":\"orangeDark\"\r\n},\r\n\"numberFormat\":{\r\n\"unit\":0,\r\n\"options\":{\r\n\"style\":\"decimal\"\r\n}\r\n}\r\n},\r\n\"showBorder\":true\r\n}\r\n},\r\n\"customWidth\":\"17\",\r\n\"name\":\"query-3-Copy-Copy-Copy-Copy\",\r\n\"styleSettings\":{\r\n\"maxWidth\":\"20\"\r\n}\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereUserId_s!=\\\"SecurityCopilot\\\"\\r\\n|whereUserId_s!~\\\"CopilotforSecurity\\\"\\r\\n|whereRecordType_d==261\\r\\n|summarizecount()bybin(TimeGenerated,1day)\",\r\n\"size\":0,\r\n\"title\":\"Promptsovertime\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"timeBrushParameterName\":\"TimeBrush\",\r\n\"exportFieldName\":\"CreatedTime\",\r\n\"exportParameterName\":\"TimePicker\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"barchart\",\r\n\"graphSettings\":{\r\n\"type\":0,\r\n\"topContent\":{\r\n\"columnMatch\":\"UserKey_s\",\r\n\"formatter\":1\r\n},\r\n\"centerContent\":{\r\n\"columnMatch\":\"promptCount\",\r\n\"formatter\":1,\r\n\"numberFormat\":{\r\n\"unit\":17,\r\n\"options\":{\r\n\"maximumSignificantDigits\":3,\r\n\"maximumFractionDigits\":2\r\n}\r\n}\r\n}\r\n}\r\n},\r\n\"name\":\"Promptsovertime\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereOperation_s!=\\\"CopilotInteraction\\\"\\r\\n|summarizeinteractioncount=count()byOperation_s\",\r\n\"size\":0,\r\n\"title\":\"CopilotforSecurityInteractioncount\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"piechart\"\r\n},\r\n\"customWidth\":\"25\",\r\n\"name\":\"query-4\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"letIP_Data=\\nexternal_data(network:string,geoname_id:long,continent_code:string,continent_name:string,country_iso_code:string,country_name:string,is_anonymous_proxy:bool,is_satellite_provider:bool)\\n[@\\\"https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv\\\"]\\nwith(ignoreFirstRecord=true,format=\\\"csv\\\");\\nCFS_Audit_CL\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\n|extendIPaddresses=tostring(ClientIP_s)\\n|whereisnotempty(IPaddresses)\\n|evaluateipv4_lookup(IP_Data,IPaddresses,network)\\n|summarizeinteractioncount=count()byClientIP_s,country_name\\n\",\r\n\"size\":0,\r\n\"title\":\"CopilotforSecurityInteractionsbyLocation\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"map\",\r\n\"mapSettings\":{\r\n\"locInfo\":\"CountryRegion\",\r\n\"locInfoColumn\":\"country_name\",\r\n\"latitude\":\"_TableName\",\r\n\"longitude\":\"_TableName\",\r\n\"sizeSettings\":\"interactioncount\",\r\n\"sizeAggregation\":\"Sum\",\r\n\"maxSize\":100,\r\n\"legendMetric\":\"interactioncount\",\r\n\"legendAggregation\":\"Count\",\r\n\"itemColorSettings\":{\r\n\"nodeColorField\":\"SignInCount\",\r\n\"colorAggregation\":\"Count\",\r\n\"type\":\"heatmap\",\r\n\"heatmapPalette\":\"greenRed\"\r\n}\r\n}\r\n},\r\n\"customWidth\":\"35\",\r\n\"name\":\"query-2\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereUserId_s!=\\\"SecurityCopilot\\\"\\r\\n|whereUserId_s!~\\\"CopilotforSecurity\\\"\\r\\n|whereisnotempty(ClientIP_s)\\r\\n|whereRecordType_d==261\\r\\n|summarizecount()byUserKey_s\\r\\n|sortbycount_\\r\\n|take10\",\r\n\"size\":0,\r\n\"title\":\"TopUsersPrompts\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"visualization\":\"table\",\r\n\"tileSettings\":{\r\n\"showBorder\":false\r\n}\r\n},\r\n\"customWidth\":\"25\",\r\n\"name\":\"query-2\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereRecordType_din(\\\"320\\\",\\\"321\\\",\\\"322\\\")\\r\\n|projectTimeGenerated,Operation=Operation_s,sessionoid=CopilotEventData_CorrelationId_g,EvaluationId=tostring(parse_json(CopilotEventData_Messages_s)[0].Id),ISPrompt=tostring(parse_json(CopilotEventData_Messages_s)[0].isPrompt),UserId=UserId_s,RecordType=RecordType_d,ClientIP=ClientIP_s,CopilotSettingsEventData_Resource=CopilotSettingsEventData_Resource_s,UserKey_s,CopilotEventData_Messages_s\\r\\n|sortbyTimeGenerated\\r\\n|projectTimeGenerated,Operation,UserId,ClientIP,CopilotSettingsEventData_Resource\\r\\n|take50\",\r\n\"size\":0,\r\n\"title\":\"CopilotforSecurity-PromptbookInteractions\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\"\r\n},\r\n\"customWidth\":\"75\",\r\n\"name\":\"query-9\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereUserId_s!=\\\"SecurityCopilot\\\"\\r\\n|whereUserId_s!~\\\"CopilotforSecurity\\\"\\r\\n|whereRecordType_d==313\\r\\n|whereparse_json(CopilotSettingsEventData_Resource_s)[0].Property<>\\\"FileUploads\\\"\\r\\n|whereparse_json(CopilotSettingsEventData_Resource_s)[0].NewValue==\\\"Enabled\\\"\\r\\n|extendPluginsName=parse_json(CopilotSettingsEventData_Resource_s)[0].Property\\r\\n|mv-expandPluginsName\\r\\n|projectTimeGenerated,UserKey_s,PluginsName\\r\\n|sortbyTimeGenerated\",\r\n\"size\":0,\r\n\"title\":\"EnablePluginOpertion\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n]\r\n},\r\n\"customWidth\":\"50\",\r\n\"name\":\"query-12\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereWorkload_s==\\\"CopilotForSecurity\\\"\\r\\n|whereUserId_s!=\\\"SecurityCopilot\\\"\\r\\n|whereUserId_s!~\\\"CopilotforSecurity\\\"\\r\\n|whereRecordType_d==314\\r\\n|whereparse_json(CopilotSettingsEventData_Resource_s)[0].Property<>\\\"FileUploads\\\"\\r\\n|whereparse_json(CopilotSettingsEventData_Resource_s)[0].NewValue==\\\"Disabled\\\"\\r\\n|extendPluginsName=parse_json(CopilotSettingsEventData_Resource_s)[0].Property\\r\\n|mv-expandPluginsName\\r\\n|projectTimeGenerated,UserKey_s,PluginsName\\r\\n|sortbyTimeGenerated\",\r\n\"size\":0,\r\n\"title\":\"DisablePlugin\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n]\r\n},\r\n\"customWidth\":\"50\",\r\n\"name\":\"query-13\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"CFS_Audit_CL\\r\\n|whereOperation_s==\\\"UpdateCopilotSettings\\\"\\r\\n//|distinctCopilotSettingsEventData_Resource_s\\r\\n|extendProperty=tostring(parse_json(CopilotSettingsEventData_Resource_s)[0].Property)\\r\\n|extendNewValue=tostring(parse_json(CopilotSettingsEventData_Resource_s)[0].NewValue)\\r\\n|extendProperty1=substring(Property,9)\\r\\n|extendEnable=NewValue\\r\\n//|whereProperty1contains\\\"tenant\\\"\\r\\n|extendSettingLevel=iff(Property1contains\\\"tenant\\\",\\\"TenantLevel\\\",\\\"Userlevel\\\")\\r\\n|projectTimeGenerated,UserId_s,Property1,SettingLevel\\r\\n|sortbySettingLevelasc\",\r\n\"size\":0,\r\n\"title\":\"ChangeSettingOpertion\",\r\n\"timeContextFromParameter\":\"TimeRange\",\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"crossComponentResources\":[\r\n\"{DefaultWorkspace}\"\r\n],\r\n\"gridSettings\":{\r\n\"formatters\":[\r\n{\r\n\"columnMatch\":\"SettingLevel\",\r\n\"formatter\":18,\r\n\"formatOptions\":{\r\n\"thresholdsOptions\":\"colors\",\r\n\"thresholdsGrid\":[\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"TenantLevel\",\r\n\"representation\":\"yellow\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"Default\",\r\n\"thresholdValue\":null,\r\n\"representation\":\"gray\",\r\n\"text\":\"{0}{1}\"\r\n}\r\n]\r\n}\r\n},\r\n{\r\n\"columnMatch\":\"Action\",\r\n\"formatter\":18,\r\n\"formatOptions\":{\r\n\"thresholdsOptions\":\"colors\",\r\n\"thresholdsGrid\":[\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"True\",\r\n\"representation\":\"green\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"contains\",\r\n\"thresholdValue\":\"False\",\r\n\"representation\":\"redBright\",\r\n\"text\":\"{0}{1}\"\r\n},\r\n{\r\n\"operator\":\"Default\",\r\n\"thresholdValue\":null,\r\n\"representation\":\"lightBlue\",\r\n\"text\":\"{0}{1}\"\r\n}\r\n]\r\n}\r\n}\r\n]\r\n}\r\n},\r\n\"name\":\"query-14\"\r\n}\r\n]\r\n},\r\n\"conditionalVisibility\":{\r\n\"parameterName\":\"Nav\",\r\n\"comparison\":\"isEqualTo\",\r\n\"value\":\"audit\"\r\n},\r\n\"name\":\"group-12\"\r\n},\r\n{\r\n\"type\":12,\r\n\"content\":{\r\n\"version\":\"NotebookGroup/1.0\",\r\n\"groupType\":\"editable\",\r\n\"items\":[\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"arg(\\\"\\\").resourcechanges\\r\\n|extendtimestamp=todatetime(properties[\\\"changeAttributes\\\"][\\\"timestamp\\\"])\\r\\n|extendchanges=properties[\\\"changes\\\"]\\r\\n|extendResourceId=tostring(properties[\\\"targetResourceId\\\"])\\r\\n|extendCorrelationId=tostring(properties[\\\"changeAttributes\\\"][\\\"correlationId\\\"])\\r\\n|extendchangeType=tostring(properties.changeType)\\r\\n|wherechangeType==\\\"Update\\\"\\r\\n|wherechangescontains\\\"numberOfUnits\\\"\\r\\n|extendnewValue=tostring(parse_json(tostring(changes.[\\\"properties.numberOfUnits\\\"])).newValue)\\r\\n|extendpreviousValue=tostring(parse_json(tostring(changes.[\\\"properties.numberOfUnits\\\"])).previousValue)\\r\\n|extendchangedBy=tostring(parse_json(tostring(properties.changeAttributes)).changedBy)\\r\\n|sortbytimestamp\\r\\n|take1\\r\\n|projecttoint(newValue)\",\r\n\"size\":4,\r\n\"title\":\"NumberOfSCU's\",\r\n\"timeContext\":{\r\n\"durationMs\":2592000000\r\n},\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"visualization\":\"tiles\",\r\n\"tileSettings\":{\r\n\"titleContent\":{\r\n\"columnMatch\":\"newValue\",\r\n\"numberFormat\":{\r\n\"unit\":17,\r\n\"options\":{\r\n\"style\":\"decimal\"\r\n}\r\n}\r\n},\r\n\"showBorder\":true\r\n}\r\n},\r\n\"customWidth\":\"30\",\r\n\"name\":\"query-0\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"arg(\\\"\\\").resourcechanges\\r\\n|extendtimestamp=todatetime(properties[\\\"changeAttributes\\\"][\\\"timestamp\\\"])\\r\\n|wheretimestamp>ago(60d)\\r\\n|extendchanges=properties[\\\"changes\\\"]\\r\\n|extendResourceId=tostring(properties[\\\"targetResourceId\\\"])\\r\\n|extendCorrelationId=tostring(properties[\\\"changeAttributes\\\"][\\\"correlationId\\\"])\\r\\n|extendchangeType=tostring(properties.changeType)\\r\\n|wherechangeType==\\\"Update\\\"\\r\\n|wherechangescontains\\\"numberOfUnits\\\"\\r\\n|extendnewValue=tostring(parse_json(tostring(changes.[\\\"properties.numberOfUnits\\\"])).newValue)\\r\\n|extendpreviousValue=tostring(parse_json(tostring(changes.[\\\"properties.numberOfUnits\\\"])).previousValue)\\r\\n|extendchangedBy=tostring(parse_json(tostring(properties.changeAttributes)).changedBy)\\r\\n|projecttimestamp,previousValue,newValue,changedBy\",\r\n\"size\":1,\r\n\"title\":\"SCUChnages\",\r\n\"timeContext\":{\r\n\"durationMs\":86400000\r\n},\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\",\r\n\"visualization\":\"table\",\r\n\"graphSettings\":{\r\n\"type\":0\r\n}\r\n},\r\n\"customWidth\":\"70\",\r\n\"name\":\"query-1\"\r\n},\r\n{\r\n\"type\":3,\r\n\"content\":{\r\n\"version\":\"KqlItem/1.0\",\r\n\"query\":\"AzureActivity\\r\\n|whereResourceProviderValuecontains\\\"copilot\\\"\",\r\n\"size\":0,\r\n\"title\":\"SCUcapacityActivities\",\r\n\"timeContext\":{\r\n\"durationMs\":86400000\r\n},\r\n\"queryType\":0,\r\n\"resourceType\":\"microsoft.operationalinsights/workspaces\"\r\n},\r\n\"name\":\"query-2\"\r\n}\r\n]\r\n},\r\n\"conditionalVisibility\":{\r\n\"parameterName\":\"Nav\",\r\n\"comparison\":\"isEqualTo\",\r\n\"value\":\"SCU\"\r\n},\r\n\"name\":\"group-4\"\r\n}\r\n],\r\n\"fallbackResourceIds\":[\r\n\"\"\r\n],\r\n\"fromTemplateId\":\"sentinel-UserWorkbook\",\r\n\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"\r\n}",
          "version": "1.0",
          "sourceId": "[variables('WorkbookSourceId')]",
          "category": "sentinel"
        }
      }
    ]
  }